<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Pattern Manifesto - AR</title>
    <link rel="stylesheet" href="css/landingStyle.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="js/sketch2.js"></script>
</head>
<body>
    <div id="landing-background"></div>
    <audio id="bgm" loop>
        <source src="asset/bgm.mp3" type="audio/mpeg">
    </audio>
    
    <!-- 시작 화면: RANDOM ACCESS 버튼만 -->
    <div id="start-screen" class="screen active">
        <button class="access-button" onclick="startExperience()">RANDOM ACCESS</button>
    </div>
    
    <!-- 컨텐츠 화면: QR 코드 등 -->
    <div id="content-screen" class="screen">
        <div class="container">
            <h1>RANDOM PATTERN MANIFESTO</h1>
            
            <div class="track-list">
                <div class="track-item">1. "Give Life Back to Music"</div>
                <div class="track-item">2. "The Game of Love"</div>
                <div class="track-item">3. "Giorgio by Moroder"</div>
                <div class="track-item">4. "Within"</div>
                <div class="track-item">5. "Instant Crush"</div>
                <div class="track-item">6. "Lose Yourself to Dance"</div>
                <div class="track-item">7. "Touch"</div>
                <div class="track-item">8. "Get Lucky"</div>
                <div class="track-item">9. "Beyond"</div>
                <div class="track-item">10. "Motherboard"</div>
                <div class="track-item">11. "Fragments of Time"</div>
                <div class="track-item">12. "Doin' It Right"</div>
                <div class="track-item">13. "Contact"</div>
            </div>
        </div>
        
        <!-- FAB 버튼 -->
        <button class="fab" onclick="openQRModal()">AR Poster</button>
    </div>
    
    <!-- QR 모달 -->
    <div id="qr-modal" class="modal" onclick="closeQRModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="qr-container">
                <img src="asset/qr.png" alt="QR Code">
            </div>
        </div>
    </div>
    
    <script>
        function startExperience() {
            // 음악 재생 시작
            const audio = document.getElementById('bgm');
            audio.play().catch(err => console.log('Audio play failed:', err));
            
            // 화면 전환
            document.getElementById('start-screen').classList.remove('active');
            document.getElementById('content-screen').classList.add('active');
            
            // 스크롤 인터랙션 초기화
            setTimeout(() => {
                initScrollInteraction();
            }, 500);
        }
        
        function openQRModal() {
            document.getElementById('qr-modal').classList.add('active');
        }
        
        function closeQRModal() {
            document.getElementById('qr-modal').classList.remove('active');
        }
        
        function initScrollInteraction() {
            const trackList = document.querySelector('.track-list');
            const trackItems = Array.from(document.querySelectorAll('.track-item'));
            const contentScreen = document.getElementById('content-screen');
            
            // HTML 재구성: 각 트랙을 스크롤 섹션으로 감싸기
            trackList.innerHTML = '';
            
            trackItems.forEach((item, index) => {
                const section = document.createElement('div');
                section.className = 'scroll-section';
                
                const wrapper = document.createElement('div');
                wrapper.className = 'track-item-wrapper';
                
                const newItem = item.cloneNode(true);
                wrapper.appendChild(newItem);
                section.appendChild(wrapper);
                trackList.appendChild(section);
            });
            
            // 스크롤 이벤트 리스너
            const sections = document.querySelectorAll('.scroll-section');
            
            function updateActiveTrack() {
                const scrollTop = contentScreen.scrollTop;
                const viewportCenter = scrollTop + window.innerHeight / 2;
                
                sections.forEach((section, index) => {
                    const rect = section.getBoundingClientRect();
                    const sectionTop = scrollTop + rect.top;
                    const sectionCenter = sectionTop + section.offsetHeight / 2;
                    const distance = Math.abs(viewportCenter - sectionCenter);
                    
                    const trackItem = section.querySelector('.track-item');
                    const isFirst = index === 0;
                    const isLast = index === sections.length - 1;
                    
                    // 첫 번째 트랙: 화면 중앙이 첫 섹션 중앙 이전이면 항상 활성화
                    if (isFirst && viewportCenter <= sectionCenter) {
                        trackItem.classList.add('active');
                    }
                    // 마지막 트랙: 화면 중앙이 마지막 섹션 중앙 이후면 항상 활성화
                    else if (isLast && viewportCenter >= sectionCenter) {
                        trackItem.classList.add('active');
                    }
                    // 중간 트랙: 화면 중앙에 가까우면 활성화
                    else if (distance < 200) {
                        trackItem.classList.add('active');
                    } else {
                        trackItem.classList.remove('active');
                    }
                });
            }
            
            contentScreen.addEventListener('scroll', updateActiveTrack);
            
            // 초기 첫 트랙 활성화
            setTimeout(() => {
                const firstTrack = sections[0]?.querySelector('.track-item');
                if (firstTrack) {
                    firstTrack.classList.add('active');
                }
            }, 100);
        }
    </script>
</body>
</html>

